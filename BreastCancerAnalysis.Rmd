---
title: "Principal Component Analysis (PCA)"
author: "Mina Fahmy"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

### Loading packages that we will be using
```{r, message=FALSE}
# devtools::install_github("vqv/ggbiplot")
# devtools::install_github("bwlewis/rthreejs")
library(RCurl)
library(knitr)
library(plyr)
library(ggbiplot)
library(rCharts)
library(qcc)
library(threejs)
library(rgl)
library(pca3d)
library(gridExtra)
```

### Load a sample data set
We would like to look at the Breast Cancer data set from UCI Machine Learning dataset repository

```{r}
link1 = 'http://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data'
names1 = c('ID','Clump.Thickness','Cell.Size','Cell.Shape','Adhesion','Epithelial',
          'Bare.Nuclei','Chromatin','Nucleoli','Mitoses','Class')

#    #  Attribute                     Domain
#    -- -----------------------------------------
#    1. Sample code number            id number
#    2. Clump Thickness               1 - 10
#    3. Uniformity of Cell Size       1 - 10
#    4. Uniformity of Cell Shape      1 - 10
#    5. Marginal Adhesion             1 - 10
#    6. Single Epithelial Cell Size   1 - 10
#    7. Bare Nuclei                   1 - 10
#    8. Bland Chromatin               1 - 10
#    9. Normal Nucleoli               1 - 10
#   10. Mitoses                       1 - 10
#   11. Class:                        (2 for benign, 4 for malignant)
dataBC = read.csv(link1, header=F)
names(dataBC) = names1
str(dataBC)
```

### Clean up the data for our analysis
```{r}
dataBC = subset(dataBC, Bare.Nuclei!='?')
dataBC$Bare.Nuclei = as.integer(dataBC$Bare.Nuclei)
dataBC = mutate(dataBC, Color=ifelse(Class==2, 'green','red'))
dataBC = mutate(dataBC, Label=ifelse(Class==2, 'Benign','Malignant'))
dataBC$Label = as.factor(dataBC$Label)
str(dataBC)
iris$color = mutate(iris, ifelse(Species=='setosa','blue', ifelse(Species=='vesricolor','green','red')))
```

### Mean centering data
```{r}
head(dataBC[,2:10])
dataMC = apply(dataBC[,2:10], 2, function(y) y - mean(y))
head(dataMC)
```

### Apply PCA
```{r}
pca = prcomp(dataBC[,2:10], center=T, scale.=T)
```

### Investigate PCA
```{r}
str(pca)
```

### Eigen Values
```{r}
round(pca$sdev^2, 2)
```

### Extract PCs
```{r}
pcs = data.frame(pca$x)
str(pcs)
```

### Percentage of variance explained by each PC
```{r}
cov = round(pca$sdev^2/sum(pca$sdev^2)*100, 2)
cov = data.frame(c(1:9),cov)
names(cov)[1] = 'PCs'
names(cov)[2] = 'Variance'
cov
```

```{r results='asis', comment=NA, warning=F, tidy=F, message=F}
p1 = hPlot(Variance~PCs, data=cov, type=c('line'), radius=7)
p1$print(include_assets=T)
```

**PCA Pareto Chart**
```{r}
PCA = pca$sdev^2
names(PCA) = paste0('PC', cov$PCs)
qcc::pareto.chart(PCA)
```

### Percentage of variance explained by PC1 and PC2
```{r}
sum(cov$Variance[1:2])
```

### Percentage of variance explained by PC1, PC2 and PC3
```{r}
sum(cov$Variance[1:3])
```

### Classification using PC1 and PC2

** R base graphics plot **
```{r}
biplot(pca,cex=0.8)
```

Based on ggplot2
```{r}
g = ggbiplot(pca, choices = 1:2, obs.scale = 1, var.scale = 1, groups = dataBC[,13], ellipse = T, circle = T)
g+theme(legend.position='top') + scale_colour_manual(values=c('green','red','blue'))
```

Visualizing relationship between different PCs
```{r}
pcs$Label = dataBC$Label
p1 = ggplot(pcs, aes(PC1, PC2, color=Label))+ geom_point() + 
     scale_colour_manual(values=c('green','red')) + theme(legend.position='none') 
p2 = ggplot(pcs, aes(PC2, PC3, color=Label))+ geom_point() +
     scale_colour_manual(values=c('green','red')) + theme(legend.position='none')
p3 = ggplot(pcs, aes(PC1, PC3, color=Label))+ geom_point() +
     scale_colour_manual(values=c('green','red')) + theme(legend.position='none')
p4 = ggplot(pcs, aes(PC1, PC4, color=Label))+geom_point() +
     scale_colour_manual(values=c('green','red')) + theme(legend.position='none')
grid.arrange(p1, p2, p3, p4, ncol=2)
```

### Classification using PC1, PC2 and PC3
```{r}
scatterplot3js(pcs[,c('PC1','PC2','PC3')], labels=dataBC$Label, 
               color = dataBC$Color, flip.y=TRUE,renderer="canvas")
```

This will show a 3D plot on your local R
```{r, eval=F}
# pca3d(pca, components = 1:3, col = dataBC$Color, biplot=T)
```


